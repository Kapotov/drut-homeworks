# Домашнее задание к занятию "Протокол OSPF. Метрика, зоны и суммаризация"

### Цель задания

Данное домашнее задание позволит научиться проектировать динамическую маршрутизацию больших размеров, правильно выбирать тип сети, манипулировать метрикой и управлять выбором лучшего маршрута. Данные знания очень важны для построения качественной и быстрой сети.  

В результате выполнения этого задания вы:

1) Научитесь проектировать мультизональную топологию в OSPF.
2) Научитесь управлять метрикой.
3) Научитесь определять и конфигурировать, какой тип сети необходим для соседства в OSPF.
4) Научитесь определять, какой маршрут будет установлен в таблице маршрутизации.
5) Научитесь определять, какой тип LSA используется для передачи данных о сети.

 
------

### Инструкция к выполнению домашнего задания

1. Сделайте копию [Шаблона для домашнего задания](https://docs.google.com/document/d/1youKpKm_JrC0UzDyUslIZW2E2bIv5OVlm_TQDvH5Pvs/edit) себе на Google Disk.
2. В названии файла введите корректное название лекции и вашу фамилию и имя.
3. Зайдите в “Настройки доступа” и выберите доступ “Просматривать могут все в Интернете, у кого есть ссылка”.
 Ссылка на инструкцию [Как предоставить доступ к файлам и папкам на Google Диске](https://support.google.com/docs/answer/2494822?hl=ru&co=GENIE.Platform%3DDesktop)
5. Скопируйте текст задания в свой документ.
6. Выполните домашнее задание, запишите ответы и приложите необходимые скриншоты в свой Google Doc.
7. Для проверки домашнего задания преподавателем отправьте ссылку на ваш документ в личном кабинете.
8. Любые вопросы по решению задач задавайте в чате учебной группы.

---

### Задание 1

Исходя из топологии на картинке, определите тип всех маршрутизаторов (internal, backbone, ABR).  
Файл с изначальной конфигурацией маршрутизаторов можете найти [здесь]( https://github.com/netology-code/drut-homeworks/blob/main/4-03/homework_4_3_routers_config.txt ) - 

![image](https://github.com/netology-code/drut-homeworks/blob/main/4-03.png)

*Приведите список маршрутизаторов R1, R2, R3, R4, R5, R6, R7 c указанием их типов.*
# Ответ

```
Исходя из предоставленной конфигурации OSPF маршрутизаторов, можно определить тип каждого маршрутизатора в этой топологии.

R1 –  Этот маршрутизатор находится только в зоне 0, поэтому он может быть классифицирован как  (backbone)

R2 – ABR (Area Border Router). Маршрутизатор R2 имеет интерфейсы в областях 0 и 3 OSPF, связывая эти области, поэтому он является маршрутизатором граничащим с областями (ABR).

R3 – ABR (Area Border Router). Маршрутизатор R3 также имеет интерфейсы в нескольких областях OSPF (0, 3 и 7), связывая их между собой, что делает его также ABR.

R4 – Этот маршрутизатор находится только в зоне 3, поэтому он может быть классифицирован как внутренний маршрутизатор (Internal).

R5 –  Этот маршрутизатор так же как R1 находится только в зоне 0, поэтому он может быть классифицирован как  (backbone)

R6 – (Internal). Маршрутизатор R6 имеет все свои интерфейсы в области 7 OSPF. Следовательно, он также может быть определен как (Internal).

R7 – (Internal). Маршрутизатор R7 имеет все свои интерфейсы в области 7 OSPF. Следовательно, он также может быть определен как (Internal).
```

---

### Задание 2

По топологии из Задания 1, определите метрику маршрута на маршрутизаторе R1 для сети 4.4.4.4/32 маршрутизатора R4 через путь R1-R2-R4 и R1-R3-R4. 

1) Какая метрика будет у данных маршрутов?
2) Какой или какие из этих маршрутов будут установлены в таблицу маршрутизатора R1? 
Для оптимальной передачи трафика, маршрут до 4.4.4.4 должен проходить только через R1-R3-R4. 
3) Является ли ситуация в таблице маршрутизации оптимальной? Если нет, то каким образом можно исправить ситуацию и на каких маршрутизаторах необходимо внести изменения?
На маршрутизаторах сделана конфигурация для анонса сети и установления соседства. Дополнительные настройки по умолчанию.

*Приведите ответы на вопросы в свободной форме. В вопросе 3, если необходима конфигурация на маршрутизаторах, то приведите команды, которые необходимо применить и на каких маршрутизаторах.*
```
На схеме представлена сеть с использованием протокола OSPF. Маршрутизаторы R1, R2, R3 и R4 участвуют в обмене маршрутами. Для сетей OSPF метрика маршрута основывается на стоимости (cost), которая по умолчанию рассчитывается как `10000000 / bandwidth_in_bps`.

1. Метрика маршрута на маршрутизаторе R1 для сети 4.4.4.4/32:
- Через путь R1-R2-R4:
  - R1-R2: `10000000 / 100000000` = 100
  - R2-R4: `10000000 / 1000000000` = 10
  - ИТОГО: 100 + 10 = 110

- Через путь R1-R3-R4:
  - R1-R3: `10000000 / 100000000` = 100
  - R3-R4: `10000000 / 1000000000` = 10
  - ИТОГО: 100 + 10 = 110

2. В таблице маршрутизации маршрутизатора R1 будут присутствовать оба маршрута, поскольку их метрика равна. OSPF в таком случае использует равнозначную балансировку нагрузки (Equal-cost multi-path, ECMP), если только не настроены дополнительные ограничения.

3. Таблица маршрутизации не оптимальна, поскольку трафик должен проходить только через маршрут R1-R3-R4. Чтобы исправить ситуацию, необходимо изменить стоимость интерфейсов так, чтобы путь через R3 был предпочтительнее. Например, можно увеличить стоимость интерфейса на маршрутизаторе R1, ведущего к R2.

Команды для маршрутизатора R1:
configure terminal
interface Gi0/0 (предполагаемый интерфейс к R2)
ip ospf cost 200
exit


Это повысит стоимость маршрута через R2, делая путь R1-R3-R4 предпочтительным.

Реальная конфигурация зависит от используемого оборудования и версии операционной системы маршрутизаторов. Команды 'configure terminal' и 'ip ospf cost' характерны для устройств Cisco.
```
### Задание 3 

По топологии из Задания 1, сеть 172.16.1.0/24 анонсируется в OSPF через R4 и R5. 
1) Какой путь или пути ( R1-R5, R1-R2-R4, R1-R3-R4)  выберет R1 для данного маршрута? Почему? Соседства между R4-R5 нет.
2) Какие метрики для данного маршрута будет у R1 для данного маршрута через каждый путь? Конфигурация по умолчанию.
3) Какие изменения конфигурации необходимо сделать, чтоб правильно учитывалась пропускная способность каждого линка на этих путях?  
4) После того, как будет учитываться правильно каждый линк, изменится ли ситуация с выбором маршрута на R1? Почему?
 
*Приведите ответы на вопросы в свободной форме. В вопросе 3, напишите точно какую/какие команды необходимо использовать на маршрутизаторах*
```
На основании предоставленной топологии и информации, R1 будет выбирать маршрут к сети 172.16.1.0/24, используя OSPF-метрики, которые по умолчанию зависят от скорости интерфейса (Bandwidth). В OSPF метрика называется "cost" и рассчитывается как 10^8, деленное на пропускную способность интерфейса в битах в секунду.

Пути, которые R1 может использовать:

1. R1-R5: Если смотреть на скорости интерфейсов, то данный маршрут имеет пропускную способность 100 Mbps на интерфейсе Gi0/1 на R1 и 1 Mbps на Gi0/1 на R5. В результате OSPF учитывает только самый "медленный" сегмент, и метрика будет основана на скорости 1 Mbps.
Именно этот маршрут будет выбран для R1, потому что он является Внутренним маршрутом Area 0 (Intra-Area Routes):

2. R1-R2-R4: Снова смотрим на скорости интерфейсов: 100 Mbps между R1 и R2, и затем 10 Gbps между R2 и R4. Учитывая, что OSPF берет в расчет наименьшую пропускную способность, метрика будет основана на 100 Mbps.
Данный Маршрут является Маршрутом между зонами (Interarea Routes)
3. R1-R3-R4: Скорости интерфейсов составляют 100 Mbps между R1 и R3, и 1 Gbps между R3 и R4. И здесь метрика будет основана на 100 Mbps.
Данный Маршрут является Маршрутом между зонами (Interarea Routes)

Таким образом, пути R1-R2-R4 и R1-R3-R4 имеют одинаковую пропускную способность с самой "узкой" точкой 100 Mbps, и предполагая, что все остальные параметры (задержка, надежность) по умолчанию одинаковы или не учтены, то R1 может выбрать один из этих маршрутов на основе других критериев, например идентификатора маршрутизатора (Router ID). Маршрут через R5 будет иметь значительно более высокую метрику из-за меньшей скорости связи и, следовательно, будет считаться худшим выбором.

Метрики у R1 для данного маршрута через каждый из путей будут следующими (если скорость измеряется в битах в секунду и используется формула cost = 10^8 / Bandwidth):

- R1-R5: cost = 10^8 / 1 000 000 = 100
- R1-R2-R4 и R1-R3-R4: cost = 10^8 / 100 000 000 = 1

Чтобы учитывать пропускную способность каждого линка, можно изменить способ, которым OSPF рассчитывает метрики, используя команду `auto-cost reference-bandwidth` в OSPF конфигурации. Например, чтобы установить значение пропускной способности для расчетов OSPF соответствующим самому быстрому линку в сети (10 Gbps в данном случае), можно использовать следующую команду на всех маршрутизаторах в OSPF:


router ospf 1
 auto-cost reference-bandwidth 10000


Эта команда указывает OSPF использовать 10 Gbps как опорную пропускную способность для расчета метрик. После этого изменения стоимость для каждого интерфейса будет пересчитана относительно новой опорной пропускной способности, что изменит метрики на всех маршрутизаторах в зависимости от реальной пропускной способности каждого линка.

```
## Дополнительные задания (со звездочкой*)

Эти задания дополнительные (не обязательные к выполнению) и никак не повлияют на получение вами зачета по этому домашнему заданию. Вы можете их выполнить, если хотите глубже и/или шире разобраться в материале.

### Задание 4*

По топологии из Задания 1, сеть 7.7.7.7/32 анонсируется маршрутизатором R7 в OSPF. Информацию о данном маршруте маршрутизатору R1 будут передавать маршрутизаторы R7-R6-R3.
Напишите, какие типы LSA каждый из маршрутизаторов будет использовать для передачи данной информации? Почему?

*Приведите ответы на вопросы в свободной форме.*
```
В данной сетевой топологии маршрутизатор R7 анонсирует сеть 7.7.7.7/32 в OSPF. Обновления о состоянии этой сети будут передаваться другим маршрутизаторам через использование типов сообщений LSA (Link State Advertisement).

Маршрутизатор R7 будет использовать LSA типа 1 (Router LSA) для передачи информации о своих подключенных сетях и состоянии соединений.
Маршрутизатор R6 будет использовать LSA типа 2 (Network LSA) для объявления о наличии сети и подключенных к ней маршрутизаторах.
Маршрутизатор R3, в свою очередь, будет получать эту информацию и использовать LSA типа 3 (Summary LSA) для передачи сводной информации о маршрутах в OSPF-области.

Таким образом, информация о сети 7.7.7.7/32 будет распространяться с помощью соответствующих типов LSA внутри OSPF-области. Различные типы LSA позволяют эффективно обмениваться информацией о топологии сети между маршрутизаторами и обеспечивать согласованность и актуальность данных о сетевой инфраструктуре.
```
### Задание 5*

Конфигурация типов линков в топологии из Задания 1, задана по умолчанию. У каких линков вы бы изменили тип линка для болеее оптимальной работы протокола OSPF? 

*Приведите ответы на вопросы в свободной форме.*
```
Все линки ( broadcast домены ), где только два маршрутизатора, то там можно менять на point-to-point.


```


### Совет
Можете использовать симулятор для построения топологии и проверки/поиска ответов на задания. Файл с изначальной конфигурцией указан в Задании 1.

### Правила приема домашнего задания

В личном кабинете отправлены:

- ссылка на документ (Google Doc) с выполненным заданием. В документе настроены права доступа “Просматривать могут все в Интернете, у кого есть ссылка”.

### Критерии оценки

Зачет - выполнены все задания, ответы даны в развернутой форме, приложены соответствующие скриншоты и файлы проекта, в выполненных заданиях нет противоречий и нарушения логики.

На доработку - задание выполнено частично или не выполнено, в логике выполнения заданий есть противоречия, существенные недостатки.
