# Домашнее задание к занятию 4.7. Методы управления трафиком.

### Цель задания

Протокол динамической маршрутизации BGP на данный момент - единственный протокол, благодаря которому работает вся сеть Интернет. Цена ошибки, допущенной при работе с этим протоколом, очень высока не только для вашей компании, но и в некоторых случаях и для всего Интернета. Поэтому умение выбирать и правильно настраивать политики управления входящим и исходящим трафиком при работе с протоколом BGP является очень важным и нужным навыком сетевого инженера.

В результате выполенения этого задания вы:
1. Научитесь выбирать технологии для управления сетевым трафиком при использовании протокола BGP
2. Освоите практические навыки по настройке протокола BGP

### Инструкция к выполнению домашнего задания

1. Сделайте копию [Шаблона для домашнего задания](https://docs.google.com/document/d/1youKpKm_JrC0UzDyUslIZW2E2bIv5OVlm_TQDvH5Pvs/edit) себе на Google Disk.
2. В названии файла введите корректное название лекции и вашу фамилию и имя.
3. Зайдите в “Настройки доступа” и выберите доступ “Просматривать могут все в Интернете, у кого есть ссылка”.
4. Ссылка на инструкцию [Как предоставить доступ к файлам и папкам на Google Диске](https://support.google.com/docs/answer/2494822?hl=ru&co=GENIE.Platform%3DDesktop)
5. Скопируйте текст задания в свой документ.
6. Выполните домашнее задание, запишите ответы и приложите необходимые скриншоты в свой Google Doc.
7. Для проверки домашнего задания преподавателем отправьте ссылку на ваш документ в личном кабинете.
8. Любые вопросы по решению задач задавайте в чате учебной группы.

------

### Задание 1

Топология:

![image](https://user-images.githubusercontent.com/46966420/162039656-bdd6cf34-1946-4e40-9ea7-edf602761a77.png)


Ваша компания владеет AS 100 и имеет два подключения к сети Интернет с использованием протокола BGP. 
- Канал к ISP А (AS200) дешевый и с большой пропускной способностью. 
- Канал к ISP B (AS300) меньше и менее надежный.  

Сетевое оборудование Cisco.

Стоит задача - максимально использовать первый канал для доступа в сеть Интернет.

1. Выберите технологию управления исходящим трафиком, которая с наименьшими затратами позволит решить эту задачу. 
2. Обоснуйте свой выбор.
3. Приведите пример настройки выбранной технологии, основываясь на информации отображенной на схеме.

*Приведите ответ в свободной форме.*

# Ответ:
```
Чтобы управлять исходящим трафиком для AS 100 и предпочитать канал к ISP A (AS 200) с большей пропускной способностью, мы можем использовать веса маршрутов (routing weights) или local preference в BGP. Поскольку вес маршрута локален для каждого маршрутизатора, то более предпочтительно использовать local preference, так как это свойство распространяется на все устройства внутри нашего автономной системы. Это позволит всему исходящему трафику предпочтительно использовать канал к ISP A (AS 200).

Пример настройки на маршрутизаторе R1:


router bgp 100
 neighbor 10.10.10.9 remote-as 200
Устанавливаем более высокий local preference для маршрутов через ISP A
 neighbor 10.10.10.9 route-map PREF_IN in
 
route-map PREF_IN permit 10
 set local-preference 200


Это заставит маршрутизатор R1 предпочитать маршруты через ISP A, тем самым максимизируя использование этого канала.
```
---

### Задание 2

Топология и компания те же.

Решив вопрос с исходящим трафиком, через некоторое время вы заметили, что большая часть входящего трафика поступает в вашу сеть от ISP B (AS300).   
Вас такое положение не устраивает. Теперь необходимо решить вопрос с входящим трафиком.

1. Выберите технологию управления входящим трафиком, которая с наименьшими затратами позволит решить эту задачу. 
2. Обоснуйте свой выбор.
3. Приведите пример настройки выбранной технологии, основываясь на информации отображенной на схеме.

*Приведите ответ в свободной форме.*
```
Для управления входящим трафиком можно использовать AS-path prepending, самообъявление (self-announcement) с различными метриками (например, MED - Multi-Exit Discriminator) или применять BGP community, если ваш ISP поддерживает их для влияния на входящий трафик. Поскольку мы хотим минимизировать использование ISP B (AS 300), мы можем использовать AS-path prepending, чтобы сделать пути через наш AS 100 менее предпочтительными к ISP B.

Пример настройки на маршрутизаторе R1:


router bgp 100
 neighbor 20.20.20.9 remote-as 300
Добавляем prepends к маршрутам, анонсируемым ISP B, чтобы они выглядели менее предпочтительными
 route-map PREPEND_OUT out
 neighbor 20.20.20.9 route-map PREPEND_OUT out
 
route-map PREPEND_OUT permit 10
 set as-path prepend 100 100 100

```
---

### Задание 3

Топология и компания те же.

Решение, выбраное в Задании 2, помогло, но недостаточно. Вы пообщались с провайдерами и выяснили, что у обоих провайдеров есть политики управления трафиком, определяемые community. 

ISP A AS_200 community:
200:xxx - Local-pref to your AS

ISP B AS_300 community:
300:xxx - Local-pref to your AS

А также Вы узнали, что между ними есть прямая связь. На этом стыке установлен атрибут local-pref со значением 200 с обоих сторон. 

Теперь необходимо воспользоваться полученым знанием, чтобы улучшить свои политики управления входящим трафиком.

1. Выберите технологию управления входящим трафиком которая позволит решить эту задачу. 
2. Обоснуйте свой выбор.
3. Приведите пример настройки выбранной технологии основываясь на информации отображенной на схеме.

*Приведите ответ в свободной форме.*

```
Имея информацию о BGP communities, вы можете общаться с ISP и запросить установку определенного local-preference для маршрутов обратно к вашему AS 100. Это позволит вам запросить у каждого ISP повышение приоритетности вашей AS при маршрутизации входящего трафика.

Пример настройки на маршрутизаторе R1 для ISP A (исходя из того, что xxx в community должно быть заменено на значение, согласованное с ISP для установления нужного local-preference):

router bgp 100
 neighbor 10.10.10.9 remote-as 200
 neighbor 10.10.10.9 send-community
 route-map SET_COMMUNITY out
 neighbor 10.10.10.9 route-map SET_COMMUNITY out
 
route-map SET_COMMUNITY permit 10
 set community 200:xxx additive


И аналогично для ISP B, заменяя значения AS и community на соответствующие для AS 300.
```
---

## Дополнительные задания (со звездочкой*)

Эти задания дополнительные (не обязательные к выполнению) и никак не повлияют на получение вами зачета по этому домашнему заданию. Вы можете их выполнить, если хотите глубже и/или шире разобраться в материале.

### Задание 4*

В указанной топологии вы управляте маршрутизатором ISPA в AS200

Требуется настроить обработку комьюнити 200:xxx для изменения Local Prefernece анонсов от клиента из AS100, которые тегированы данным community. 
Возможные значения xxx:
1. 300 - Local Prefernece 300
2. 600 - Local Preference 600 

1. Создайте нужное количество community list 
2. Создайте route-map
3. Примените route-map на стык с клиентом

*Приведите ответ в свободной форме.*

---

### Правила приема домашнего задания

В личном кабинете отправлены:
- ссылка на документ (Google Doc) с выполненным заданием. В документе настроены права доступа “Просматривать могут все в Интернете, у кого есть ссылка”;

### Критерии оценки

Зачет - выполнены все задания, ответы даны в развернутой форме, приложены соответствующие скриншоты и файлы проекта, в выполненных заданиях нет противоречий и нарушения логики.

На доработку - задание выполнено частично или не выполнено, в логике выполнения заданий есть противоречия, существенные недостатки.
